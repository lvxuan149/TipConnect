"use strict";(()=>{var e={};e.id=126,e.ids=[126],e.modules={399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},640:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>y,patchFetch:()=>f,requestAsyncStorage:()=>_,routeModule:()=>c,serverHooks:()=>h,staticGenerationAsyncStorage:()=>m});var o={};r.r(o),r.d(o,{GET:()=>p});var i=r(5197),a=r(326),s=r(1009),n=r(4680),l=r(7312),u=r(6357),d=r(3562);async function p(e,{params:t}){try{let{id:e}=t,[r,o,i]=await Promise.all([l.db.select().from(u.E7).where((0,d.eq)(u.E7.id,e)).limit(1),l.db.select().from(u.U3),l.db.select().from(u.OW).where((0,d.eq)(u.OW.host_id,e))]),a=r[0];if(!a)return n.NextResponse.json({error:"Creator not found"},{status:404});let s=i.map(e=>e.id),p=o.filter(e=>e.story_id&&s.includes(e.story_id)),c=0,_=new Set,m=0;for(let e of p)"tip"===e.type?(c+=Number(e.amount||0),_.add(e.signer)):"share"===e.type&&(m+=1);let h=i.map(e=>{let t=p.filter(t=>t.story_id===e.id).filter(e=>"tip"===e.type).reduce((e,t)=>e+Number(t.amount||0),0);return{id:e.id,title:e.title,total_sol:t}}).sort((e,t)=>t.total_sol-e.total_sol);return n.NextResponse.json({id:a.id,name:a.name,avatar_url:a.avatar_url||"",headline:a.headline||`${i.length} stories`,reputation:{total_sol:c,supporters:_.size,shares:m},stories:h})}catch(e){return console.error("Error in /api/creators/[id]:",e),n.NextResponse.json({error:"Failed to fetch creator details"},{status:500})}}let c=new i.AppRouteRouteModule({definition:{kind:a.x.APP_ROUTE,page:"/api/creators/[id]/route",pathname:"/api/creators/[id]",filename:"route",bundlePath:"app/api/creators/[id]/route"},resolvedPagePath:"/Users/lvxuan/github/TipConnect/app/api/creators/[id]/route.ts",nextConfigOutput:"",userland:o}),{requestAsyncStorage:_,staticGenerationAsyncStorage:m,serverHooks:h}=c,y="/api/creators/[id]/route";function f(){return(0,s.patchFetch)({serverHooks:h,staticGenerationAsyncStorage:m})}},6357:(e,t,r)=>{r.d(t,{E7:()=>p,OW:()=>d,U3:()=>c,zc:()=>_});var o=r(989),i=r(7533),a=r(2582),s=r(3755),n=r(2723),l=r(8873),u=r(3836);let d=(0,o.af)("stories",{id:(0,i.L7)("id",{length:64}).primaryKey(),title:(0,a.fL)("title").notNull(),summary:(0,a.fL)("summary").default(""),host_id:(0,i.L7)("host_id",{length:64}).notNull(),created_at:(0,s.AB)("created_at",{withTimezone:!0}).defaultNow()}),p=(0,o.af)("hosts",{id:(0,i.L7)("id",{length:64}).primaryKey(),name:(0,a.fL)("name").notNull(),web2_links:(0,a.fL)("web2_links").default("[]"),created_at:(0,s.AB)("created_at",{withTimezone:!0}).defaultNow()}),c=(0,o.af)("events",{id:(0,i.L7)("id",{length:72}).primaryKey().$defaultFn(()=>crypto.randomUUID()),type:(0,i.L7)("type",{length:16}).notNull(),signer:(0,i.L7)("signer",{length:128}).notNull(),receiver:(0,i.L7)("receiver",{length:128}).notNull(),amount:(0,n.uR)("amount",{precision:18,scale:9}).default("0"),tx_signature:(0,i.L7)("tx_signature",{length:128}).notNull(),story_id:(0,i.L7)("story_id",{length:64}),timestamp:(0,l.Kv)("timestamp",{mode:"number"}).notNull()},e=>({byTxType:(0,u.o9)("uniq_tx_type").on(e.tx_signature,e.type),byStory:(0,u.Kz)("idx_story").on(e.story_id)})),_=(0,o.af)("host_metrics",{host_id:(0,i.L7)("host_id",{length:64}).primaryKey(),total_tip_value_sol:(0,n.uR)("total_tip_value_sol",{precision:18,scale:9}).default("0"),unique_supporters:(0,n.uR)("unique_supporters",{precision:10,scale:0}).default("0"),share_count:(0,n.uR)("share_count",{precision:10,scale:0}).default("0"),stories_count:(0,n.uR)("stories_count",{precision:10,scale:0}).default("0"),updated_at:(0,s.AB)("updated_at",{withTimezone:!0}).defaultNow()});(0,o.af)("story_metrics_daily",{id:(0,i.L7)("id",{length:72}).primaryKey().$defaultFn(()=>crypto.randomUUID()),story_id:(0,i.L7)("story_id",{length:64}).notNull(),date:(0,s.AB)("date",{withTimezone:!0}).notNull(),total_tip_value_sol:(0,n.uR)("total_tip_value_sol",{precision:18,scale:9}).default("0"),unique_supporters:(0,n.uR)("unique_supporters",{precision:10,scale:0}).default("0"),share_count:(0,n.uR)("share_count",{precision:10,scale:0}).default("0"),created_at:(0,s.AB)("created_at",{withTimezone:!0}).defaultNow()},e=>({byStoryDate:(0,u.o9)("uniq_story_date").on(e.story_id,e.date),byStory:(0,u.Kz)("idx_story").on(e.story_id),byDate:(0,u.Kz)("idx_date").on(e.date)}))},7312:(e,t,r)=>{r.d(t,{db:()=>l});var o=r(7136),i=r(7910);let a=process.env.DATABASE_URL||"",s=a.includes("channel_binding=")?a:a+(a.includes("?")?"&":"?")+"channel_binding=disable";if(!s)throw Error("DATABASE_URL is not set");let n=(0,i.qn)(s),l=(0,o.tS)(n)}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),o=t.X(0,[764,914],()=>r(640));module.exports=o})();
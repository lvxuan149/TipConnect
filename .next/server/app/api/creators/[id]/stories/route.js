"use strict";(()=>{var e={};e.id=726,e.ids=[726],e.modules={399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},5401:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>h,patchFetch:()=>f,requestAsyncStorage:()=>_,routeModule:()=>c,serverHooks:()=>y,staticGenerationAsyncStorage:()=>m});var i={};r.r(i),r.d(i,{GET:()=>p});var o=r(5197),s=r(326),a=r(1009),n=r(4680),l=r(7312),u=r(6357),d=r(3562);async function p(e,{params:t}){try{let{id:e}=t,r=await l.db.select().from(u.OW).where((0,d.eq)(u.OW.host_id,e));if(0===r.length)return n.NextResponse.json({items:[]});let i=await l.db.select().from(u.U3),o=r.map(e=>{let t=i.filter(t=>t.story_id===e.id),r=t.filter(e=>"tip"===e.type).reduce((e,t)=>e+Number(t.amount||0),0),o=new Set(t.filter(e=>"tip"===e.type).map(e=>e.signer)),s=t.filter(e=>"share"===e.type).length;return{id:e.id,title:e.title,summary:e.summary,created_at:e.created_at,metrics:{total_sol:r,supporters:o.size,shares:s}}}).sort((e,t)=>t.metrics.total_sol-e.metrics.total_sol);return n.NextResponse.json({items:o})}catch(e){return console.error("Error in /api/creators/[id]/stories:",e),n.NextResponse.json({error:"Failed to fetch creator stories"},{status:500})}}let c=new o.AppRouteRouteModule({definition:{kind:s.x.APP_ROUTE,page:"/api/creators/[id]/stories/route",pathname:"/api/creators/[id]/stories",filename:"route",bundlePath:"app/api/creators/[id]/stories/route"},resolvedPagePath:"/Users/lvxuan/github/TipConnect/app/api/creators/[id]/stories/route.ts",nextConfigOutput:"",userland:i}),{requestAsyncStorage:_,staticGenerationAsyncStorage:m,serverHooks:y}=c,h="/api/creators/[id]/stories/route";function f(){return(0,a.patchFetch)({serverHooks:y,staticGenerationAsyncStorage:m})}},6357:(e,t,r)=>{r.d(t,{E7:()=>p,OW:()=>d,U3:()=>c,zc:()=>_});var i=r(989),o=r(7533),s=r(2582),a=r(3755),n=r(2723),l=r(8873),u=r(3836);let d=(0,i.af)("stories",{id:(0,o.L7)("id",{length:64}).primaryKey(),title:(0,s.fL)("title").notNull(),summary:(0,s.fL)("summary").default(""),host_id:(0,o.L7)("host_id",{length:64}).notNull(),created_at:(0,a.AB)("created_at",{withTimezone:!0}).defaultNow()}),p=(0,i.af)("hosts",{id:(0,o.L7)("id",{length:64}).primaryKey(),name:(0,s.fL)("name").notNull(),web2_links:(0,s.fL)("web2_links").default("[]"),created_at:(0,a.AB)("created_at",{withTimezone:!0}).defaultNow()}),c=(0,i.af)("events",{id:(0,o.L7)("id",{length:72}).primaryKey().$defaultFn(()=>crypto.randomUUID()),type:(0,o.L7)("type",{length:16}).notNull(),signer:(0,o.L7)("signer",{length:128}).notNull(),receiver:(0,o.L7)("receiver",{length:128}).notNull(),amount:(0,n.uR)("amount",{precision:18,scale:9}).default("0"),tx_signature:(0,o.L7)("tx_signature",{length:128}).notNull(),story_id:(0,o.L7)("story_id",{length:64}),timestamp:(0,l.Kv)("timestamp",{mode:"number"}).notNull()},e=>({byTxType:(0,u.o9)("uniq_tx_type").on(e.tx_signature,e.type),byStory:(0,u.Kz)("idx_story").on(e.story_id)})),_=(0,i.af)("host_metrics",{host_id:(0,o.L7)("host_id",{length:64}).primaryKey(),total_tip_value_sol:(0,n.uR)("total_tip_value_sol",{precision:18,scale:9}).default("0"),unique_supporters:(0,n.uR)("unique_supporters",{precision:10,scale:0}).default("0"),share_count:(0,n.uR)("share_count",{precision:10,scale:0}).default("0"),stories_count:(0,n.uR)("stories_count",{precision:10,scale:0}).default("0"),updated_at:(0,a.AB)("updated_at",{withTimezone:!0}).defaultNow()});(0,i.af)("story_metrics_daily",{id:(0,o.L7)("id",{length:72}).primaryKey().$defaultFn(()=>crypto.randomUUID()),story_id:(0,o.L7)("story_id",{length:64}).notNull(),date:(0,a.AB)("date",{withTimezone:!0}).notNull(),total_tip_value_sol:(0,n.uR)("total_tip_value_sol",{precision:18,scale:9}).default("0"),unique_supporters:(0,n.uR)("unique_supporters",{precision:10,scale:0}).default("0"),share_count:(0,n.uR)("share_count",{precision:10,scale:0}).default("0"),created_at:(0,a.AB)("created_at",{withTimezone:!0}).defaultNow()},e=>({byStoryDate:(0,u.o9)("uniq_story_date").on(e.story_id,e.date),byStory:(0,u.Kz)("idx_story").on(e.story_id),byDate:(0,u.Kz)("idx_date").on(e.date)}))},7312:(e,t,r)=>{r.d(t,{db:()=>l});var i=r(7136),o=r(7910);let s=process.env.DATABASE_URL||"",a=s.includes("channel_binding=")?s:s+(s.includes("?")?"&":"?")+"channel_binding=disable";if(!a)throw Error("DATABASE_URL is not set");let n=(0,o.qn)(a),l=(0,i.tS)(n)}};var t=require("../../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),i=t.X(0,[764,914],()=>r(5401));module.exports=i})();
(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[990],{2067:e=>{"use strict";e.exports=require("node:async_hooks")},6195:e=>{"use strict";e.exports=require("node:buffer")},1614:(e,t,r)=>{"use strict";r.r(t),r.d(t,{ComponentMod:()=>N,default:()=>b});var n={};r.r(n),r.d(n,{GET:()=>_,runtime:()=>p});var i={};r.r(i),r.d(i,{originalPathname:()=>g,patchFetch:()=>w,requestAsyncStorage:()=>h,routeModule:()=>f,serverHooks:()=>m,staticGenerationAsyncStorage:()=>y});var o=r(1409),s=r(7140),a=r(2913),u=r(4474),l=r(8144),d=r(7607),c=r(799);let p="edge";async function _(){try{let[e,t,r]=await Promise.all([d.db.select().from(c.E7),d.db.select().from(c.OW),d.db.select().from(c.U3)]),n=new Map;for(let t of e)n.set(t.id,{total_sol:0,supporters:new Set,shares:0,stories_count:0});for(let e of t){let t=n.get(e.host_id);t&&(t.stories_count+=1)}for(let e of r){let r=t.find(t=>t.id===e.story_id);if(!r)continue;let i=n.get(r.host_id);i&&("tip"===e.type?(i.total_sol+=Number(e.amount||0),i.supporters.add(e.signer)):"share"===e.type&&(i.shares+=1))}let i=e.map(e=>{let t=n.get(e.id)||{total_sol:0,supporters:new Set,shares:0,stories_count:0},r="",i=`${t.stories_count} stories`;try{let t=JSON.parse(e.web2_links||"[]");Array.isArray(t)&&t.length>0&&(r=t[0].avatar_url||"",i=t[0].headline||i)}catch(e){}return{id:e.id,name:e.name,avatar_url:r,headline:i,total_sol:t.total_sol/1e9}}).sort((e,t)=>t.total_sol-e.total_sol);return l.xk.json({items:i})}catch(e){return console.error("Error in /api/creators:",e),l.xk.json({error:"Failed to fetch creators"},{status:500})}}let f=new s.AppRouteRouteModule({definition:{kind:a.x.APP_ROUTE,page:"/api/creators/route",pathname:"/api/creators",filename:"route",bundlePath:"app/api/creators/route"},resolvedPagePath:"/Users/lvxuan/github/TipConnect/app/api/creators/route.ts",nextConfigOutput:"",userland:n}),{requestAsyncStorage:h,staticGenerationAsyncStorage:y,serverHooks:m}=f,g="/api/creators/route";function w(){return(0,u.XH)({serverHooks:m,staticGenerationAsyncStorage:y})}let N=i,b=o.a.wrap(f)},799:(e,t,r)=>{"use strict";r.d(t,{U3:()=>g,E7:()=>m,OW:()=>y});var n=r(4974),i=r(8775),o=r(5573),s=r(8047),a=r(7921),u=r(8898),l=r(5998),d=r(9457),c=r(1271);class p{constructor(e,t){this.unique=e,this.name=t}static [d.Q]="PgIndexBuilderOn";on(...e){return new _(e.map(e=>{if((0,d.is)(e,l.$s))return e;let t=new c.pK(e.name,!!e.keyAsName,e.columnType,e.indexConfig);return e.indexConfig=JSON.parse(JSON.stringify(e.defaultConfig)),t}),this.unique,!1,this.name)}onOnly(...e){return new _(e.map(e=>{if((0,d.is)(e,l.$s))return e;let t=new c.pK(e.name,!!e.keyAsName,e.columnType,e.indexConfig);return e.indexConfig=e.defaultConfig,t}),this.unique,!0,this.name)}using(e,...t){return new _(t.map(e=>{if((0,d.is)(e,l.$s))return e;let t=new c.pK(e.name,!!e.keyAsName,e.columnType,e.indexConfig);return e.indexConfig=JSON.parse(JSON.stringify(e.defaultConfig)),t}),this.unique,!0,this.name,e)}}class _{static [d.Q]="PgIndexBuilder";config;constructor(e,t,r,n,i="btree"){this.config={name:n,columns:e,unique:t,only:r,method:i}}concurrently(){return this.config.concurrently=!0,this}with(e){return this.config.with=e,this}where(e){return this.config.where=e,this}build(e){return new f(this.config,e)}}class f{static [d.Q]="PgIndex";config;constructor(e,t){this.config={...e,table:t}}}function h(e){return new p(!1,e)}let y=(0,n.af)("stories",{id:(0,i.L7)("id",{length:64}).primaryKey(),title:(0,o.fL)("title").notNull(),summary:(0,o.fL)("summary").default(""),host_id:(0,i.L7)("host_id",{length:64}).notNull(),created_at:(0,s.AB)("created_at",{withTimezone:!0}).defaultNow()}),m=(0,n.af)("hosts",{id:(0,i.L7)("id",{length:64}).primaryKey(),name:(0,o.fL)("name").notNull(),web2_links:(0,o.fL)("web2_links").default("[]"),created_at:(0,s.AB)("created_at",{withTimezone:!0}).defaultNow()}),g=(0,n.af)("events",{id:(0,i.L7)("id",{length:72}).primaryKey().$defaultFn(()=>crypto.randomUUID()),type:(0,i.L7)("type",{length:16}).notNull(),signer:(0,i.L7)("signer",{length:128}).notNull(),receiver:(0,i.L7)("receiver",{length:128}).notNull(),amount:(0,a.uR)("amount",{precision:18,scale:9}).default("0"),tx_signature:(0,i.L7)("tx_signature",{length:128}).notNull(),story_id:(0,i.L7)("story_id",{length:64}),timestamp:(0,u.Kv)("timestamp",{mode:"number"}).notNull()},e=>({byTxType:new p(!0,"uniq_tx_type").on(e.tx_signature,e.type),byStory:h("idx_story").on(e.story_id)}));(0,n.af)("host_metrics",{host_id:(0,i.L7)("host_id",{length:64}).primaryKey(),total_tip_value_sol:(0,a.uR)("total_tip_value_sol",{precision:18,scale:9}).default("0"),unique_supporters:(0,a.uR)("unique_supporters",{precision:10,scale:0}).default("0"),share_count:(0,a.uR)("share_count",{precision:10,scale:0}).default("0"),stories_count:(0,a.uR)("stories_count",{precision:10,scale:0}).default("0"),updated_at:(0,s.AB)("updated_at",{withTimezone:!0}).defaultNow()}),(0,n.af)("story_metrics_daily",{id:(0,i.L7)("id",{length:72}).primaryKey().$defaultFn(()=>crypto.randomUUID()),story_id:(0,i.L7)("story_id",{length:64}).notNull(),date:(0,s.AB)("date",{withTimezone:!0}).notNull(),total_tip_value_sol:(0,a.uR)("total_tip_value_sol",{precision:18,scale:9}).default("0"),unique_supporters:(0,a.uR)("unique_supporters",{precision:10,scale:0}).default("0"),share_count:(0,a.uR)("share_count",{precision:10,scale:0}).default("0"),created_at:(0,s.AB)("created_at",{withTimezone:!0}).defaultNow()},e=>({byStoryDate:new p(!0,"uniq_story_date").on(e.story_id,e.date),byStory:h("idx_story").on(e.story_id),byDate:h("idx_date").on(e.date)}))},7607:(e,t,r)=>{"use strict";r.d(t,{db:()=>u});var n=r(2325),i=r(1400);let o=process.env.DATABASE_URL||"",s=o.includes("channel_binding=")?o:o+(o.includes("?")?"&":"?")+"channel_binding=disable";if(!s)throw Error("DATABASE_URL is not set");let a=(0,i.qn)(s),u=(0,n.tS)(a)}},e=>{var t=t=>e(e.s=t);e.O(0,[855],()=>t(1614));var r=e.O();(_ENTRIES="undefined"==typeof _ENTRIES?{}:_ENTRIES)["middleware_app/api/creators/route"]=r}]);
//# sourceMappingURL=route.js.map
(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[105],{2067:e=>{"use strict";e.exports=require("node:async_hooks")},6195:e=>{"use strict";e.exports=require("node:buffer")},2223:(e,t,r)=>{"use strict";r.r(t),r.d(t,{ComponentMod:()=>S,default:()=>T});var s={};r.r(s),r.d(s,{GET:()=>E,runtime:()=>v});var o={};r.r(o),r.d(o,{originalPathname:()=>N,patchFetch:()=>C,requestAsyncStorage:()=>h,routeModule:()=>c,serverHooks:()=>w,staticGenerationAsyncStorage:()=>_});var a=r(1409),n=r(7140),i=r(2913),u=r(4474),l=r(8144),p=r(7607),d=r(5998);let v="edge";async function E(){let e=Date.now();try{let t=await p.db.execute((0,d.i6)`
      SELECT
        COALESCE(SUM(CASE WHEN type = 'tip' THEN amount ELSE 0 END), 0) as total_sol,
        COUNT(DISTINCT CASE WHEN type = 'tip' THEN signer END) as supporters,
        COUNT(CASE WHEN type = 'share' THEN 1 END) as shares
      FROM events
    `),r=t.rows?.[0]??{total_sol:0,supporters:0,shares:0},s={total_sol:Number(r.total_sol||0).toFixed(3),supporters:Number(r.supporters||0),shares:Number(r.shares||0)},o=Date.now()-e;return console.log("[overview]",{table_checked:"events",duration_ms:o,total_sol:s.total_sol,supporters:s.supporters,shares:s.shares}),l.xk.json(s,{headers:{"Cache-Control":"s-maxage=30, stale-while-revalidate=300"}})}catch(e){return console.error("[overview error]",e.message),l.xk.json({error:"Failed to fetch overview data"},{status:500})}}let c=new n.AppRouteRouteModule({definition:{kind:i.x.APP_ROUTE,page:"/api/overview/route",pathname:"/api/overview",filename:"route",bundlePath:"app/api/overview/route"},resolvedPagePath:"/Users/lvxuan/github/TipConnect/app/api/overview/route.ts",nextConfigOutput:"",userland:s}),{requestAsyncStorage:h,staticGenerationAsyncStorage:_,serverHooks:w}=c,N="/api/overview/route";function C(){return(0,u.XH)({serverHooks:w,staticGenerationAsyncStorage:_})}let S=o,T=a.a.wrap(c)},7607:(e,t,r)=>{"use strict";r.d(t,{db:()=>u});var s=r(2325),o=r(1400);let a=process.env.DATABASE_URL||"",n=a.includes("channel_binding=")?a:a+(a.includes("?")?"&":"?")+"channel_binding=disable";if(!n)throw Error("DATABASE_URL is not set");let i=(0,o.qn)(n),u=(0,s.tS)(i)}},e=>{var t=t=>e(e.s=t);e.O(0,[855],()=>t(2223));var r=e.O();(_ENTRIES="undefined"==typeof _ENTRIES?{}:_ENTRIES)["middleware_app/api/overview/route"]=r}]);
//# sourceMappingURL=route.js.map
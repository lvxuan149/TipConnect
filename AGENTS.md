# Repository Guidelines

## Project Structure & Module Organization
- **app/**: Next.js routes and UI; API handlers live under `app/api` and use `@/lib` and `@/drizzle` aliases.
- **lib/**: shared services (e.g., `lib/db.ts` for database access) and cross-cutting utilities.
- **drizzle/**: schema definition in `schema.ts` plus SQL migrations generated by Drizzle Kit.
- **scripts/**: operational helpers (seeders, diagnostics) executed with `tsx`.
- **tests/**: Vitest suites; create feature-focused subdirectories when tests grow.

## Build, Test, and Development Commands
- `pnpm dev`: run the Next.js dev server; loads environment from `.env.local`.
- `pnpm dev:up`: prepare database (diagnostics, migrations, seed) before starting dev server.
- `pnpm build`: compile the production bundle and validate type safety.
- `pnpm start`: serve the previously built app.
- `pnpm lint`: execute ESLint across the repo.
- `pnpm test`: run Vitest recursively; use `pnpm test:e2e` / `test:contract` / `test:idempotency` for focused suites.

## Coding Style & Naming Conventions
- TypeScript everywhere; keep files in kebab-case (e.g., `user-card.tsx`).
- Prefer 2-space indentation and trailing commas per repository defaults.
- Reuse established aliases like `@/lib/*` and `@/drizzle/*`; avoid relative paths that backtrack multiple levels.
- Run `pnpm lint` before pushing to ensure ESLint (with Next.js plugin) passes.
- Co-locate component-specific styles in the same directory; global Tailwind utilities live in `app/globals.css`.

## Testing Guidelines
- Write Vitest specs alongside source (`component.test.tsx`) or within `tests/` when cross-cutting.
- Cover happy paths and error branches for API routes, especially database interactions.
- Use `pnpm test --watch` during development; add regression tests for every production bug fix.
- Aim for meaningful assertions; prefer snapshot tests only when structure is stable.

## Commit & Pull Request Guidelines
- Follow Conventional Commits (`feat: add discover endpoint`); keep summaries â‰¤ 72 characters.
- Reference issues in the commit body when applicable and describe high-level implementation notes.
- Pull requests should include: context, testing evidence (`pnpm test`, `pnpm lint`), and screenshots/GIFs for UI changes.
- Request review from domain owners (API, UI, or data) and ensure migrations are reversible before merge.

## Security & Configuration Notes
- Store secrets in `.env.local`; never commit credentials. Provide `.env.example` updates when variables change.
- Run `pnpm dev:up` after modifying Drizzle schema to keep migrations in sync.
- Keep third-party keys scoped to development; production credentials reside in managed hosting environments.
